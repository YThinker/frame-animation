!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).FrameAnimation={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},e.apply(this,arguments)};function r(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))}function n(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o={},a={get exports(){return o},set exports(t){o=t}},s={},c={get exports(){return s},set exports(t){s=t}};(function(){var t,e,r,n,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?c.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(c.exports=function(){return(t()-i)/1e6},e=process.hrtime,n=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),o=1e9*process.uptime(),i=n-o):Date.now?(c.exports=function(){return Date.now()-r},r=Date.now()):(c.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(i);for(var l=s,u="undefined"==typeof window?i:window,f=["moz","webkit"],m="AnimationFrame",h=u["request"+m],p=u["cancel"+m]||u["cancelRequest"+m],y=0;!h&&y<f.length;y++)h=u[f[y]+"Request"+m],p=u[f[y]+"Cancel"+m]||u[f[y]+"CancelRequest"+m];if(!h||!p){var d=0,g=0,b=[];h=function(t){if(0===b.length){var e=l(),r=Math.max(0,16.666666666666668-(e-d));d=r+e,setTimeout((function(){var t=b.slice(0);b.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(d)}catch(t){setTimeout((function(){throw t}),0)}}),Math.round(r))}return b.push({handle:++g,callback:t,cancelled:!1}),g},p=function(t){for(var e=0;e<b.length;e++)b[e].handle===t&&(b[e].cancelled=!0)}}a.exports=function(t){return h.call(u,t)},o.cancel=function(){p.apply(u,arguments)},o.polyfill=function(t){t||(t=u),t.requestAnimationFrame=h,t.cancelAnimationFrame=p};var w=function(t){return t instanceof HTMLElement},v=function(t){return t instanceof HTMLImageElement||t instanceof HTMLSourceElement||t instanceof HTMLEmbedElement||t instanceof HTMLIFrameElement},F=.1,S="function"==typeof Float32Array;function _(t,e){return 1-3*e+3*t}function T(t,e){return 3*e-6*t}function M(t){return 3*t}function P(t,e,r){return((_(e,r)*t+T(e,r))*t+M(e))*t}function k(t,e,r){return 3*_(e,r)*t*t+2*T(e,r)*t+M(e)}function I(t){return t}var N=function(t,e,r,n){if(!(0<=t&&t<=1&&0<=r&&r<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&r===n)return I;for(var i=S?new Float32Array(11):new Array(11),o=0;o<11;++o)i[o]=P(o*F,t,r);function a(e){for(var n=0,o=1;10!==o&&i[o]<=e;++o)n+=F;--o;var a=n+(e-i[o])/(i[o+1]-i[o])*F,s=k(a,t,r);return s>=.001?function(t,e,r,n){for(var i=0;i<4;++i){var o=k(e,r,n);if(0===o)return e;e-=(P(e,r,n)-t)/o}return e}(e,a,t,r):0===s?a:function(t,e,r,n,i){var o,a,s=0;do{(o=P(a=e+(r-e)/2,n,i)-t)>0?r=a:e=a}while(Math.abs(o)>1e-7&&++s<10);return a}(e,n,n+F,t,r)}return function(t){return 0===t?0:1===t?1:P(a(t),e,n)}},R={linear:[0,0,1,1],ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-in-out":[.42,0,.58,1],"ease-out":[0,0,.58,1]},x=function(){function t(t,r,n){this.config={totalFrameNumber:0,imageDirection:"vertical",fps:60,infinite:!1,delayFrame:0,fillMode:"none",imgSrcList:[],prefetch:!1,motionDirection:"normal"},this.currentFrame=0,this.lastStartTimestamp=0,this.onstart=function(){},this.onprefetch=function(t){},this.onupdate=function(t){},this.oncomplete=function(t){},this.rafSymbol=null,"transform"!==n||w(t)||console.warn("Element should be <picture> or <img> when draw type is transform"),"imgSrc"!==n||v(t)||console.warn("Element should be <img> when draw type is transform"),this.element=t,this.drawType=n,this.config=e(e({},this.config),r),this.prefetchImageSource()}return t.prototype.prefetchImageSource=function(){var t;return r(this,void 0,void 0,(function(){var e;return n(this,(function(r){switch(r.label){case 0:return this.config.prefetch&&(null===(t=this.config)||void 0===t?void 0:t.imgSrcList.length)?[4,Promise.all(this.config.imgSrcList.map((function(t){return new Promise((function(e,r){var n=new Image;n.onload=function(){return e(!0)},n.onerror=function(){return r(!1)},n.onabort=function(){return r(!1)},n.src=t}))})))]:[3,2];case 1:e=r.sent(),this.onprefetch(e),r.label=2;case 2:return[2]}}))}))},t.prototype._calcFrameInterval=function(){return 1e3/("number"==typeof this.config.fps?this.config.fps:60)},t.prototype._calcOneFramePercent=function(){return 1/(this.config.totalFrameNumber-("transform"===this.drawType?0:1))*100},t.prototype._calcCurrentFrame=function(t){var e=Math.abs(this.currentFrame)%this.config.totalFrameNumber;return this.currentFrame<0&&("backwards"===this.config.fillMode||"both"===this.config.fillMode)&&(e=0),"rtl"===t&&(e=this.config.totalFrameNumber-e-1),e},t.prototype._drawBackground=function(t){if(w(this.element)){var e=this._calcCurrentFrame(t),r=this._calcOneFramePercent();"horizontal"===this.config.imageDirection?this.element.style.backgroundPosition="".concat(e*r,"% 0"):this.element.style.backgroundPosition="0 ".concat(e*r,"%")}},t.prototype._drawTransform=function(t){if(w(this.element)){var e=this._calcCurrentFrame(t),r=this._calcOneFramePercent();"horizontal"===this.config.imageDirection?this.element.style.transform="translate(-".concat(e*r,"%, 0)"):this.element.style.transform="translate(0, -".concat(e*r,"%)")}},t.prototype._drawImageSource=function(t){if(v(this.element)){var e=this._calcCurrentFrame(t);this.element.src=this.config.imgSrcList[e]}},t.prototype.renderFrame=function(t,e){this.currentFrame=t,"transform"===this.drawType?this._drawTransform(e):"imgSrc"===this.drawType?this._drawImageSource(e):this._drawBackground(e)},t.prototype.draw=function(t,e,r){void 0===t&&(t="ltr");var n=this.rafSymbol;if(0===this.lastStartTimestamp||e-this.lastStartTimestamp>=this._calcFrameInterval()){if(this.lastStartTimestamp=e,this.renderFrame(this.currentFrame,t),this.onupdate(e),r)return;if(this.currentFrame+(this.config.infinite?0:1)===this.config.totalFrameNumber)return this.oncomplete(e),"alternate"===this.config.motionDirection?(this.currentFrame=0,void this.continue("ltr"===t?"rtl":"ltr")):this.config.infinite?void this.start(t):void("both"!==this.config.fillMode&&"forwards"!==this.config.fillMode&&n===this.rafSymbol&&(this.currentFrame+=1,this._setRaf(t,n,!0)));this.currentFrame+=1}this._setRaf(t,n,r)},t.prototype._setRaf=function(t,e,r){var n=this;e&&this.rafSymbol!==e||(this.rafSymbol=o((function(e){return n.draw(t,e,r)})))},t.prototype.start=function(t){this.currentFrame=0-this.config.delayFrame,this.lastStartTimestamp=0,"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr"),this.onstart()},t.prototype.continue=function(t){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr")},t.prototype.interrupt=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null},t.prototype.cancel=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null,this.currentFrame=0,this.lastStartTimestamp=0},t}(),C=function(){function t(t,r,n){this.config={totalFrameNumber:0,columnNumber:0,fps:60,infinite:!1,delayFrame:0,fillMode:"none",motionDirection:"normal"},this.currentFrame=0,this.lastStartTimestamp=0,this.onstart=function(){},this.onupdate=function(t){},this.oncomplete=function(t){},this.rafSymbol=null,"transform"!==n||w(t)||console.warn("Element should be <picture> or <img> when draw type is transform"),this.element=t,this.drawType=n||"background",this.config=e(e({},this.config),r)}return t.prototype._calcFrameInterval=function(){return 1e3/("number"==typeof this.config.fps?this.config.fps:60)},t.prototype._calcOneFramePercent=function(){var t=this.config.columnNumber,e=Math.ceil(this.config.totalFrameNumber/this.config.columnNumber);return"background"===this.drawType&&(t-=1,e-=1),{rowPercent:1/e*100,columnPercent:1/t*100}},t.prototype._calcCurrentFrame=function(t){var e=Math.abs(this.currentFrame)%this.config.totalFrameNumber;return this.currentFrame<0&&("backwards"===this.config.fillMode||"both"===this.config.fillMode)&&(e=0),"rtl"===t&&(e=this.config.totalFrameNumber-e-1),{current:e,currentRow:Math.floor(e/this.config.columnNumber),currentColumn:e%this.config.columnNumber}},t.prototype._drawBackground=function(t){if(w(this.element)){var e=this._calcCurrentFrame(t),r=e.currentRow,n=e.currentColumn,i=this._calcOneFramePercent(),o=i.rowPercent,a=i.columnPercent;this.element.style.backgroundPosition="".concat(n*a,"% ").concat(r*o,"%")}},t.prototype._drawTransform=function(t){if(w(this.element)){var e=this._calcCurrentFrame(t),r=e.currentRow,n=e.currentColumn,i=this._calcOneFramePercent(),o=i.rowPercent,a=i.columnPercent;this.element.style.transform="translate(-".concat(n*a,"%, -").concat(r*o,"%)")}},t.prototype.renderFrame=function(t,e){this.currentFrame=t,"transform"===this.drawType?this._drawTransform(e):this._drawBackground(e)},t.prototype.draw=function(t,e,r){void 0===t&&(t="ltr");var n=this.rafSymbol;if(0===this.lastStartTimestamp||e-this.lastStartTimestamp>=this._calcFrameInterval()){if(this.lastStartTimestamp=e,this.renderFrame(this.currentFrame,t),this.onupdate(e),r)return;if(this.currentFrame+(this.config.infinite?0:1)===this.config.totalFrameNumber)return this.oncomplete(e),"alternate"===this.config.motionDirection?(this.currentFrame=0,void this.continue("ltr"===t?"rtl":"ltr")):this.config.infinite?void this.start(t):void("both"!==this.config.fillMode&&"forwards"!==this.config.fillMode&&n===this.rafSymbol&&(this.currentFrame+=1,this._setRaf(t,n,!0)));this.currentFrame+=1}this._setRaf(t,n,r)},t.prototype._setRaf=function(t,e,r){var n=this;e&&this.rafSymbol!==e||(this.rafSymbol=o((function(e){return n.draw(t,e,r)})))},t.prototype.start=function(t){this.currentFrame=0-this.config.delayFrame,this.lastStartTimestamp=0,"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr"),this.onstart()},t.prototype.continue=function(t){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr")},t.prototype.interrupt=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null},t.prototype.cancel=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null,this.currentFrame=0,this.lastStartTimestamp=0},t}(),E=function(){function t(t,r,n){this.config={totalFrameNumber:0,direction:"vertical",duration:1e3,infinite:!1,timingFunction:"linear",delay:0,fillMode:"none",imgSrcList:[],prefetch:!1},this.firstStart=!0,this.lastStartTimestamp=0,this.lastCurrentFrame=0,this.cumulativeTime=0,this.onstart=function(){},this.onprefetch=function(t){},this.onupdate=function(t){},this.oncomplete=function(t){},this.rafSymbol=null,"transform"!==n||w(t)||console.warn("Element should be <picture> or <img> when draw type is transform"),"imgSrc"!==n||v(t)||console.warn("Element should be <img> when draw type is transform"),this.element=t,this.drawType=n,this.config=e(e({},this.config),r),this.prefetchImageSource()}return t.prototype.prefetchImageSource=function(){var t;return r(this,void 0,void 0,(function(){var e;return n(this,(function(r){switch(r.label){case 0:return this.config.prefetch&&(null===(t=this.config)||void 0===t?void 0:t.imgSrcList.length)?[4,Promise.all(this.config.imgSrcList.map((function(t){return new Promise((function(e,r){var n=new Image;n.onload=function(){return e(!0)},n.onerror=function(){return r(!1)},n.onabort=function(){return r(!1)},n.src=t}))})))]:[3,2];case 1:e=r.sent(),this.onprefetch(e),r.label=2;case 2:return[2]}}))}))},t.prototype._calcFrameInterval=function(t){var e,r,n=this.cumulativeTime/this.config.duration,i=null!==(r=null===(e=this.easingFunction)||void 0===e?void 0:e.call(this,n))&&void 0!==r?r:n;return Math.ceil(1e3*i)/1e3},t.prototype._calcOneFramePercent=function(){return 1/(this.config.totalFrameNumber-("transform"===this.drawType?0:1))*100},t.prototype._calcCurrentFrame=function(t,e){var r=t%this.config.totalFrameNumber;return"rtl"===e?this.config.totalFrameNumber-r-1:r},t.prototype._drawBackground=function(t,e){if(w(this.element)){var r=this._calcCurrentFrame(t,e),n=this._calcOneFramePercent();"horizontal"===this.config.direction?this.element.style.backgroundPosition="".concat(r*n,"% 0"):this.element.style.backgroundPosition="0 ".concat(r*n,"%")}},t.prototype._drawTransform=function(t,e){if(w(this.element)){var r=this._calcCurrentFrame(t,e),n=this._calcOneFramePercent();"horizontal"===this.config.direction?this.element.style.transform="translate(-".concat(r*n,"%, 0)"):this.element.style.transform="translate(0, -".concat(r*n,"%)")}},t.prototype._drawImageSource=function(t,e){if(v(this.element)){var r=this._calcCurrentFrame(t,e);this.element.src=this.config.imgSrcList[r]}},t.prototype._renderFrame=function(t,e){"transform"===this.drawType?this._drawTransform(t,e):"imgSrc"===this.drawType?this._drawImageSource(t,e):this._drawBackground(t,e)},t.prototype.draw=function(t,e,r){void 0===t&&(t="ltr");var n=this.rafSymbol;this.firstStart&&(this.firstStart=!1,this.lastStartTimestamp=e,this.cumulativeTime=this.config.delay);var i=this._calcFrameInterval(e);if(i>=1)return this.oncomplete(e),this.config.infinite?void this.start(t):void 0;this.cumulativeTime+=e-this.lastStartTimestamp,this.lastStartTimestamp=e;var o=Math.ceil(this.config.totalFrameNumber*i);this._renderFrame(o,t),this.lastCurrentFrame!==o&&(this.onupdate(e),this.lastCurrentFrame=o),this._setRaf(t,n,r)},t.prototype._setRaf=function(t,e,r){var n=this;e&&this.rafSymbol!==e||(this.rafSymbol=o((function(e){return n.draw(t,e,r)})))},t.prototype.start=function(t){var e,r;this.cumulativeTime=0,this.easingFunction=(e=this.config.timingFunction,r=R.linear,"string"==typeof e?R[e]?r=R[e]:console.warn("Inlegal timingFunction: ",e):Array.isArray(e)&&4===e.length?r=e:console.warn("Inlegal timingFunction: ",e),N.apply(void 0,r)),"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr"),this.onstart()},t.prototype.continue=function(t){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this._setRaf(null!=t?t:"ltr")},t.prototype.interrupt=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null},t.prototype.cancel=function(){"number"==typeof this.rafSymbol&&o.cancel(this.rafSymbol),this.rafSymbol=null,this.firstStart=!0,this.cumulativeTime=0},t}();t.MultilineFrameAnimation=C,t.SinglelineFrameAnimation=x,t.SinglelineFrameAnimation2=E}));
